(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[84],{"/MQX":function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));r("JiVo");var n=r("/dBk"),a=r.n(n),o=r("qd51"),i=(r("kxJY"),r("0NLz"));function c(e){return s.apply(this,arguments)}function s(){return(s=Object(o.a)(a.a.mark((function e(t){var r,n,o=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>1&&void 0!==o[1]&&o[1],Array.isArray(t)){e.next=3;break}return e.abrupt("return",Object(i.a)(t,r));case 3:return e.next=5,Promise.all(t.map((function(e){return Object(i.a)(e,r)})));case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},"0NLz":function(e,t,r){"use strict";(function(e,n){r.d(t,"a",(function(){return T}));var a=r("m6w3"),o=r("/dBk"),i=r.n(o),c=r("qd51"),s=r("czhI"),u=r.n(s),d=r("UNwp"),l=r("YFs1"),p=r.n(l),f=r("H034"),v=r.n(f),b=r("SsGC"),g=r("0tlJ"),h=r("PnJF"),k=r("hMrr");function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach((function(t){Object(a.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var m="\n  const axios = require('axios');\n  const { workerData, parentPort } = require('worker_threads');\n  const options = workerData.options;\n  axios(options)\n  .then(res => {\n    parentPort.postMessage({key: workerData.key, data: {\n      data: res.data,\n      status: res.status,\n      headers: res.headers\n    }});\n\n    // exist thread\n    process.exit();\n  })\n",O=!1,x=[],_=0,j=!1,S=[],P=null,N=function(e){x.map((function(t){return t(e)}))},A=function(t,r){try{var n=e,a=n.redisClient,o=n.zlib,i={data:t.data||null,status:t.status||200};o.deflate(JSON.stringify(i),(function(e,t){a.set(r,t.toString("base64"),1800)}))}catch(c){console.log("SAVE RESPONSE TO REDIS FAIL",c)}},R=function(t){e.redisClient.set(t,0,1)};function E(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null}var I=function(e){var t={};return e.url&&(t.url=e.url),e.baseURL&&(t.baseURL=e.baseURL),e.params&&(t.params=e.params),e.method&&(t.method=e.method),e.data&&(t.data=e.data),JSON.stringify(t)};function T(e,t){return D.apply(this,arguments)}function D(){return(D=Object(c.a)(i.a.mark((function t(a,o){var s,u,d,l,f,v,h,w,O,x,_,j,S,N,T,D;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=!1,u={},u=g.a.getJSON(b.a)||{},d=y({},a.headers),l=!1,f=null,s){x=null===(v=r("h+Qp"))||void 0===v||null===(h=v.data)||void 0===h?void 0:h.user_agent,l=new RegExp("googlebot","i").test(x),(_=null===(w=r("h+Qp"))||void 0===w||null===(O=w.data)||void 0===O?void 0:O.xff)&&(d["X-Forwarded-For"]=d["X-Forwarded-For"]||_),x&&(d["User-Agent"]=d["User-Agent"]||x);try{f=null===(j=e)||void 0===j?void 0:j.startMonitorRequestPart((null===a||void 0===a?void 0:a.url)||"unknow")}catch(J){}}if(o){t.next=45;break}if(t.prev=8,"undefined"===typeof navigator){t.next=40;break}if(!Object(k.b)()){t.next=39;break}if(u={},null!==(S=E("app_data"))){t.next=32;break}if("undefined"===typeof Native){t.next=21;break}u.access_token=Native.getAppAccessToken()||"",u.platform="android",u.token_type="bearer",t.next=30;break;case 21:if("undefined"===typeof native){t.next=30;break}return t.next=24,native.getAppAccessToken;case 24:if(t.t0=t.sent,t.t0){t.next=27;break}t.t0="";case 27:u.access_token=t.t0,u.platform="ios",u.token_type="bearer";case 30:t.next=37;break;case 32:N=atob(S),T=N?JSON.parse(N):{},u.access_token=p()(T)?"":T.access_token,u.platform="ios",u.token_type="bearer";case 37:t.next=40;break;case 39:u.platform="web";case 40:t.next=45;break;case 42:t.prev=42,t.t1=t.catch(8),console.log(t.t1);case 45:return p()(u)||(u.token_type&&"guest"!==u.token_type?"undefined"!==typeof u.access_token&&(d["x-access-token"]=u.access_token):d["x-guest-token"]=u.guest_token?u.guest_token:u.access_token),D=y(y({baseURL:s?"http://tala-kong.tiki.services:8000":"https://tiki.vn/api",withCredentials:!0,timeout:o?3e3:0},a),{},{headers:d}),t.abrupt("return",new Promise(function(){var t=Object(c.a)(i.a.mark((function t(r,o){var c,u,d,p,v,b;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c=I(D),s&&a.usingWorker&&!l){t.next=5;break}P.request(D).then((function(e){r(e)})).catch((function(){o.apply(void 0,arguments)})).finally((function(){if(s)try{e.endMonitorRequestPart(f)}catch(J){}})),t.next=27;break;case 5:return u=e.workerThreads.Worker,d=e.redisClient,t.next=9,d.get(c);case 9:if(!(p=t.sent)){t.next=26;break}return t.prev=11,e.zlib.unzip(n.from(p,"base64"),(function(e,t){if(e)return o(e);var n=t.toString();r(JSON.parse(n))})),v="worker_"+c,t.next=17,d.get(v);case 17:t.sent||(b=new u(m,{eval:!0,workerData:{key:c,options:D}}),d.set(v,1,3600),b.on("message",(function(e){e.key===c&&(A(e.data,c),R(v))})),b.on("exit",(function(e){R(v)})),b.on("error",(function(e){R(v)}))),t.next=24;break;case 21:t.prev=21,t.t0=t.catch(11),o(t.t0);case 24:t.next=27;break;case 26:P.request(D).then((function(e){A(e,c),r(e)})).catch((function(e){try{o(y(y({},e),{},{axiosConfig:D}))}catch(t){o(e)}})).finally((function(){try{e.endMonitorRequestPart(f)}catch(J){}}));case 27:case"end":return t.stop()}}),t,null,[[11,21]])})));return function(e,r){return t.apply(this,arguments)}}()));case 48:case"end":return t.stop()}}),t,null,[[8,42]])})))).apply(this,arguments)}var J=function(){var e=Object(c.a)(i.a.mark((function e(t,r){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.original,e.abrupt("return",new Promise(function(){var e=Object(c.a)(i.a.mark((function e(r,a){var o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T({baseURL:"https://api.tiki.vn",url:"/heimdall/v1/challenges",method:"POST",headers:{"x-original":n},data:{data:t}});case 3:o=e.sent,r(o.data),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),a(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),M=function(){var e=g.a.getJSON("TOKENS");return p()(e)||!e.token_type||"guest"===e.token_type},U=function(){return new Promise(function(){var e=Object(c.a)(i.a.mark((function e(t,r){var n,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T({url:"/v2/account/logout"});case 3:n=e.sent,t(n),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),r(e.t0);case 10:return e.prev=10,localStorage.removeItem("access-token"),g.a.remove("TOKENS"),null===(a=sessionStorage)||void 0===a||a.removeItem("activeRefreshToken"),e.finish(10);case 14:case"end":return e.stop()}}),e,null,[[0,7,10,14]])})));return function(t,r){return e.apply(this,arguments)}}())},q=function(e){var t,r=y(y({},g.a.getJSON("TOKENS")),e);t=r,localStorage.setItem("access-token",JSON.stringify(t)),g.a.set("TOKENS",t,{expires:30})},C=function(){var e=Object(c.a)(i.a.mark((function e(){var t,r=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]&&r[0],e.abrupt("return",new Promise(function(){var e=Object(c.a)(i.a.mark((function e(r,n){var a,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,(a=g.a.getJSON("TOKENS")).access_token&&a.refresh_token){e.next=5;break}return r(!1),e.abrupt("return");case 5:return e.next=7,T({url:"/v3/tokens",method:"post",data:{grant_type:"refresh_token",refresh_token:a.refresh_token,is_active:t||void 0}});case 7:o=e.sent,r(o.data),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),n(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,r){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(P=u.a.create()).interceptors.response.use((function(e){return e}),function(){var e=Object(c.a)(i.a.mark((function e(t){var r,n,a,o,s,u,l,p,f,k,w,y,m,A,R,E,I,D,F,L;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=t.config,s=t.response,u=(s=void 0===s?{}:s).status,l=s.data,p=o||{},f=M(),k=g.a.getJSON(b.a),w={};try{w=Object(d.a)(k.access_token)}catch(z){}if(y=(null===(r=p.url)||void 0===r?void 0:r.indexOf("/v3/tokens"))>-1&&!(p.data instanceof FormData)&&(null===(n=p.data)||void 0===n?void 0:n.indexOf("refresh_token"))>-1,m=!(p.data instanceof FormData)&&(null===(a=p.data)||void 0===a?void 0:a.indexOf("is_active"))>-1,!y||m){e.next=16;break}return e.next=13,U();case 13:return T({url:"v2/checkout/error_report",method:"POST",data:Object(h.a)({axiosResponse:(null===t||void 0===t?void 0:t.response)||{},screenId:"refresh_token",customerId:null===(A=w)||void 0===A?void 0:A.customer_id,displayMessage:"Refresh token th\u1ea5t b\u1ea1i"})},!1),window.location="/",e.abrupt("return",Promise.reject(t));case 16:if(401!==u||f||y){e.next=20;break}return O||(O=!0,C().then(function(){var e=Object(c.a)(i.a.mark((function e(r){var n,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(O=!1,!r){e.next=14;break}if(!(++_>3)){e.next=10;break}return _=0,x=[],e.next=8,U();case 8:return window.location="/",e.abrupt("return");case 10:q(r),N(r),e.next=19;break;case 14:return T({url:"v2/checkout/error_report",method:"POST",data:Object(h.a)({request:{current_page:window.location.href,last_request:JSON.stringify(null===t||void 0===t||null===(n=t.response)||void 0===n?void 0:n.config),token_info:k},screenId:"refresh_token",customerId:null===(a=w)||void 0===a?void 0:a.customer_id,displayMessage:!1===r?"Token b\u1ecb m\u1ea5t":"API refresh_token kh\xf4ng tr\u1ea3 v\u1ec1 data"})},!1),e.next=17,U();case 17:N(),window.location="/";case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){O=!1,N(e)})).finally((function(){x=[]}))),R=new Promise((function(e,r){var n;n=function(n){n&&n.access_token?(p.headers["x-access-token"]=n.access_token,e(P(p))):r(t)},x.push(n)})),e.abrupt("return",R);case 20:if(428!==u){e.next=44;break}if(j){e.next=43;break}return j=!0,e.prev=23,E=null===l||void 0===l?void 0:l.challenge_id,e.next=27,window.__rt_t(E);case 27:return I=e.sent,e.next=30,J(I,{original:p.url},T);case 30:return S.map((function(e){return e()})),e.abrupt("return",P(p));case 34:return e.prev=34,e.t0=e.catch(23),v()(t,"response.status",400),null!==(D=t.response)&&void 0!==D&&null!==(F=D.data)&&void 0!==F&&null!==(L=F.error)&&void 0!==L&&L.message||v()(t,"response.data.error.message","Thi\u1ebft b\u1ecb ho\u1eb7c phi\xean b\u1ea3n s\u1eed d\u1ee5ng kh\xf4ng ph\xf9 h\u1ee3p, vui l\xf2ng n\xe2ng c\u1ea5p!"),e.abrupt("return",Promise.reject(t));case 39:return e.prev=39,j=!1,S=[],e.finish(39);case 43:return e.abrupt("return",new Promise((function(e){S.push((function(){e(P(p))}))})));case 44:if(!(u>=500&&u<=599&&p._5xxRetry)){e.next=47;break}return p._5xxRetry=!1,e.abrupt("return",P(p));case 47:return e.abrupt("return",Promise.reject(t));case 48:case"end":return e.stop()}}),e,null,[[23,34,39,43]])})));return function(t){return e.apply(this,arguments)}}())}).call(this,r("bqPV"),r("qykS").Buffer)},"0tlJ":function(e,t,r){"use strict";var n=r("2W1i"),a=r.n(n);t.a={set:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r.domain||(r.domain=".tiki.vn"),a.a.set(e,t,r)},get:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.domain||(t.domain=".tiki.vn"),a.a.get(e,t)},remove:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.domain||(t.domain=".tiki.vn"),a.a.remove(e,t)},getJSON:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.domain||(t.domain=".tiki.vn");try{var r=a.a.get(e,t)||{};return JSON.parse(r)}catch(n){return{}}}}},PnJF:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r("TsRJ"),a=r.n(n),o=r("zYYD"),i=r.n(o),c="production",s=function(){var e,t,r,n,o,s,u,d,l,p,f,v,b,g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},h=g.axiosResponse,k=g.screenId,w=void 0===k?"":k,y=g.customerId,m=void 0===y?0:y,O=g.displayMessage,x=g.request,_=O||(null===h||void 0===h||null===(e=h.data)||void 0===e||null===(t=e.error)||void 0===t?void 0:t.message),j=null===h||void 0===h||null===(r=h.config)||void 0===r?void 0:r.baseURL,S=a()(null===h||void 0===h||null===(n=h.request)||void 0===n?void 0:n.responseURL,j,"");return{platform:"desktop",env:c,api:S,method:null===h||void 0===h||null===(o=h.config)||void 0===o?void 0:o.method,screen_id:w,customer_id:m,error_code:null===h||void 0===h?void 0:h.status,error_message:null===h||void 0===h||null===(s=h.data)||void 0===s||null===(u=s.error)||void 0===u?void 0:u.message,display_message:i()(_),access_token:null===h||void 0===h||null===(d=h.config)||void 0===d||null===(l=d.headers)||void 0===l?void 0:l["x-access-token"],guest_token:null===h||void 0===h||null===(p=h.config)||void 0===p||null===(f=p.headers)||void 0===f?void 0:f["x-guest-token"],request:x||JSON.stringify(null===h||void 0===h||null===(v=h.config)||void 0===v?void 0:v.data),response:null===h||void 0===h||null===(b=h.request)||void 0===b?void 0:b.responseText}}},SsGC:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n="TOKENS"},"cc7+":function(e,t,r){"use strict";r.d(t,"a",(function(){return N}));var n=r("JiVo"),a=r("/dBk"),o=r.n(a),i=r("m6w3"),c=r("qd51"),s=r("eeCi"),u=r.n(s),d=(r("kxJY"),r("edSL")),l=r.n(d),p=r("YFs1"),f=r.n(p),v=r("FMmX"),b=r.n(v),g=(r("vVlW"),r("sGr+")),h=r("gXvo"),k=r("/MQX");function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach((function(t){Object(i.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var m,O="AMPLITUDE_INITIALIZED",x="AMPLITUDE_USER_PROPS",_="AMPLITUDE_QUEUE",j=function(){return Object(g.d)()?"pwa":new b.a(window.navigator.userAgent).mobile()||"TikiNative"===window.navigator.userAgent||"Tiki"===window.navigator.userAgent.appName?"mobile_web":"desktop_web"},S=function(){var e=Object(c.a)(o.a.mark((function e(){var t,r,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(k.a)({url:"".concat("https://tiki.vn/api","/duck/consumer/external/reward/v1/account")});case 2:return r=e.sent,n=Object(g.c)(x),Object(g.g)(x,y(y({},n||{}),(null===r||void 0===r||null===(t=r.data)||void 0===t?void 0:t.data)||{})),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),P=function(){try{var e=JSON.parse(localStorage.getItem("delivery-zone"));return{user_current_city:l()(e,"data.region",""),user_current_district:l()(e,"data.district",""),user_current_province:l()(e,"data.ward","")}}catch(t){return console.log(t,""),null}},N=function(){var e=Object(c.a)(o.a.mark((function e(){var t,r,a,i,c,s,u,d,l,p,v,b=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(e.prev=0,t=sessionStorage.getItem(O),r=b.length,a=new Array(r),i=0;i<r;i++)a[i]=b[i];if(t){e.next=9;break}c=Object(g.c)(_,[]),s=f()(c)?[{args:a}]:[].concat(Object(n.a)(c),[{args:a}]),Object(g.g)(_,s),e.next=22;break;case 9:if(d=Object(g.c)(x),!f()(d)){e.next=17;break}return e.next=13,S();case 13:d=Object(g.c)(x),l=y(y(y({},d||{}),P()||{}),{},{web_platform:j(),user_agent:window.navigator.userAgent}),Object(g.g)(x,l),d=l;case 17:window.amplitude.setUserProperties(d),(u=window.amplitude).logEvent.apply(u,a),p=null===a||void 0===a?void 0:a[0],v=null===a||void 0===a?void 0:a[1],h.a.trackingV2({event_properties:v,event_type:p},"v2");case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(0),console.log("Amplitude",e.t0);case 27:case"end":return e.stop()}}),e,null,[[0,24]])})));return function(){return e.apply(this,arguments)}}();m=function(e){var t=e.widgets,r=void 0===t?[]:t;return u()(r,{type:"tikingon_message"}).length>0}},gXvo:function(e,t,r){"use strict";var n=r("/dBk"),a=r.n(n),o=r("m6w3"),i=r("qd51"),c=r("czhI"),s=r.n(c),u=r("FMmX"),d=r.n(u),l=r("A7Sg"),p=r("vVlW"),f=r("hMrr");r("0tlJ");function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach((function(t){Object(o.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var g=function(){var e,t,r="";try{r=window.top.document.referrer}catch(n){if(window.parent)try{r=window.top.document.referrer}catch(n){r=""}}""==r&&(r=(null===(e=window)||void 0===e||null===(t=e.location)||void 0===t?void 0:t.href)||"");return r},h=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},k=function(e){var t,r=document.cookie.split(";");for(t=0;t<r.length;t++){var n=r[t].substr(0,r[t].indexOf("=")),a=r[t].substr(r[t].indexOf("=")+1);if(n.replace(/^\s+|\s+$/g,"")==e)return unescape(a)}return null},w=function(e){var t=k(e);return t||(t=h()),function(e,t,r){var n,a,o=new Date;o.setDate(o.getDate()+t);var i=(null===(n=window)||void 0===n||null===(a=n.location)||void 0===a?void 0:a.hostname)||"",c=i.split(".");4==c.length&&c[0]>=0&&c[0]<=255&&c[1]>=0&&c[1]<=255&&c[2]>=0&&c[2]<=255&&c[3]>=0&&c[3]<=255||(i="."+i.replace(/^www./,""));var s=escape(r)+(null==t?"":";expires="+o.toUTCString())+";SameSite=None; Secure;path=/;domain="+i;document.cookie=e+"="+s}(e,730,t),t},y=function(){try{return Object(f.b)()?function(){try{return Object(f.b)()&&(["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document)}catch(e){console.log("[Error] isIOSApp",e)}}()?"ios":"android":new d.a(window.navigator.userAgent).mobile()||"TikiNative"===window.navigator.userAgent||"Tiki"===window.navigator.userAgent.appName?"mobile_web":"desktop_web"}catch(e){return console.log("[Error] getPlatform",e),"desktop_web"}},m=function(){var e=Object(i.a)(a.a.mark((function e(t){var r,n,o,i,c,u,d,v,g,h,m,O,x,S,P,N,A,R=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=R.length>1&&void 0!==R[1]?R[1]:"v1",i=R.length>2&&void 0!==R[2]?R[2]:function(){},c=R.length>3&&void 0!==R[3]?R[3]:function(){},!Object(p.a)()){e.next=5;break}return e.abrupt("return");case 5:if(u=_(),d=w("_trackity"),v=k("_ga"),g=k("_gid"),h=new Date,m={client_id:d,key:"v1"==o?"1111c112a1b2531170f676e052cffpro":"14134330-0d38-49f9-9c77-dcc26ccdf637",referrer:u,page:null===(r=window)||void 0===r||null===(n=r.location)||void 0===n?void 0:n.href,platform:y(),ga:v||"",gid:g||"",created_at:h.getTime(),sanitized_at:h.toISOString()},"v2"===o&&(O=k("_fbp"),x=k("_fbc"),O&&(m._fbp=O),x&&(m._fbc=x)),S=Object(f.b)(),e.prev=10,!S){e.next=25;break}if(P=null,"undefined"===typeof Native){e.next=17;break}P=Native.getAppClientId(),e.next=24;break;case 17:if("undefined"===typeof native){e.next=24;break}return e.next=20,native.getAppClientId;case 20:if(e.t0=e.sent,e.t0){e.next=23;break}e.t0="";case 23:P=e.t0;case 24:P&&(m.app_client_id=P);case 25:e.next=30;break;case 27:e.prev=27,e.t1=e.catch(10),console.log(e.t1);case 30:return N=null,A=null,A="v2"===o?Array.isArray(t)?"https://"+"trackity.tiki.vn".replace(/[/]*$/,"")+"/v2/bulkevents":"https://"+"trackity.tiki.vn".replace(/[/]*$/,"")+"/v2/single":Array.isArray(t)?"https://"+"trackity.tiki.vn".replace(/[/]*$/,"")+"/bulkevents":"https://"+"trackity.tiki.vn".replace(/[/]*$/,"")+"/tracking",N=Array.isArray(t)?{created_at:h.getTime(),events:t.map((function(e){return b(b({},m),e)}))}:b(b({},m),t),e.abrupt("return",(function(){if(j.swReady&&"v1"===o)try{navigator.serviceWorker.ready.then((function(e){e.active.postMessage({type:l.d,action:l.b,payload:b({version:o},N)})}))}catch(e){console.log("SERVICE WORKER FORWARDING ERROR",e)}else s()({url:A,method:"POST",withCredentials:!0,headers:{"Content-Type":"application/json;charset=UTF-8",Authorization:"v1"===o?"1111c112a1b2531170f676e052cffpro":"14134330-0d38-49f9-9c77-dcc26ccdf637"},data:N}).then(i).catch(c)}));case 35:case"end":return e.stop()}}),e,null,[[10,27]])})));return function(t){return e.apply(this,arguments)}}(),O=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};"undefined"!==typeof document&&("complete"===document.readyState?t():setTimeout((function(){e(t)}),50))},x=function(){var e=Object(i.a)(a.a.mark((function e(t,r,n){var o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m(t,"v1",r,n);case 3:o=e.sent,O(o),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r,n){return e.apply(this,arguments)}}(),_=function(){try{return window._tk_referrer_state.prev}catch(e){return g()}},j={swReady:!1,tracking:x,trackingV2:function(){var e=Object(i.a)(a.a.mark((function e(t,r,n){var o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m(t,"v2",r,n);case 3:o=e.sent,O(o),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r,n){return e.apply(this,arguments)}}(),getReferrer:_,setReferrer:function(e){try{var t=window._tk_referrer_state||{prev:g(),current:g()};t.prev=t.current,t.current=e,window._tk_referrer_state=t}catch(r){}},push:x,getClientId:function(){return w("_trackity")},listeningServiceWorkerMessage:function(e){try{var t=e.data;t.type===l.d&&t.action===l.c&&(this.swReady=!0)}catch(r){}},getNativeClientId:function(){var e=Object(i.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"undefined"===typeof Native){e.next=5;break}return e.abrupt("return",Native.getAppClientId());case 5:return e.next=7,native.getAppClientId;case 7:if(e.t0=e.sent,e.t0){e.next=10;break}e.t0="";case 10:return e.abrupt("return",e.t0);case 11:e.next=16;break;case 13:return e.prev=13,e.t1=e.catch(0),e.abrupt("return","");case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(){return e.apply(this,arguments)}}()};try{window.trackity=j}catch(S){}t.a=j}}]);