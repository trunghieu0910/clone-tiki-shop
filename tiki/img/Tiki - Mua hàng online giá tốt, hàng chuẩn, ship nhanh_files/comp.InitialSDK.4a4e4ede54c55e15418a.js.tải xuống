(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[221],{ePid:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return b}));var n=r("etRO"),a=r("4jfz"),o=r("mHfP"),c=r("1U+3"),i=r("DY1Z"),u=r("5UAf"),s=r("mXGw"),l=r("xEuF"),d=r("Jzau"),p=r("a1Hr"),f=r("y1FF");function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(i.a)(e);if(t){var a=Object(i.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(c.a)(this,r)}}var b=function(e){Object(o.a)(r,e);var t=v(r);function r(){var e;Object(n.a)(this,r);for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];return(e=t.call.apply(t,[this].concat(o))).state={ready:!1},e.trackityIndentify=function(){var t=e.props.customer,r=t.email,n=t.id;r&&n&&Object(f.a)({email:r,id:n})},e}return Object(a.a)(r,[{key:"componentDidMount",value:function(){var e=this,t=this.props.delaySDK,r=void 0===t||t;localStorage.getItem(l.b)||Object(l.f)(!1),this.interval=setInterval((function(){"complete"!==window.document.readyState||e.state.ready||(setTimeout((function(){e.setState({ready:!0});var t=e.props.customer;null===t||void 0===t||t.id;!function(){try{window.fbAsyncInit=function(){var e;FB.init({appId:"220558114759707",autoLogAppEvents:!0,xfbml:!0,version:"v3.1"}),null!==(e=window)&&void 0!==e&&e.FBSDK&&(window.FBSDK.map((function(e){return e()})),window.FBSDK={},window.FBSDK.push=function(e){return e()})},function(e,t,r){var n,a=e.getElementsByTagName(t)[0];e.getElementById(r)||((n=e.createElement(t)).id=r,n.src="https://connect.facebook.net/en_US/sdk.js",a.parentNode.insertBefore(n,a))}(document,"script","facebook-jssdk")}catch(e){console.log("FACEBOOK",e)}}(),Object(p.a)(),Object(d.a)(),e.props.customer&&(Object(p.b)(t,e.props.route),Object(d.b)({userId:t}),e.trackityIndentify())}),r?3e3:0),e.interval&&clearInterval(e.interval))}),100)}},{key:"componentWillUnmount",value:function(){this.interval&&clearInterval(this.interval)}},{key:"componentDidUpdate",value:function(e){var t;!e.customer&&this.props.customer&&(Object(p.b)(this.props.customer,this.props.route),this.trackityIndentify(),Object(u.a)(null===(t=this.props.customer)||void 0===t?void 0:t.id))}},{key:"render",value:function(){return null}}]),r}(s.Component)},xEuF:function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return v})),r.d(t,"c",(function(){return g})),r.d(t,"d",(function(){return m})),r.d(t,"g",(function(){return h})),r.d(t,"f",(function(){return y})),r.d(t,"e",(function(){return k}));var n=r("/dBk"),a=r.n(n),o=r("uEoR"),c=r("qd51"),i=r("edSL"),u=r.n(i),s=r("8qar"),l=r.n(s),d=r("cph9"),p=r("RQuD"),f="delivery_zone",v="delivery-zone",b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise((function(t,r){return navigator.geolocation.getCurrentPosition(t,r,e)}))},g=function(e){var t=e.replace(/Qu\u1eadn/g,"Q.");return t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/qu\u1eadn/g,"Q.")).replace(/Ph\u01b0\u1eddng/g,"P.")).replace(/ph\u01b0\u1eddng/g,"P.")).replace(/Th\xe0nh Ph\u1ed1/g,"TP.")).replace(/Th\xe0nh ph\u1ed1/g,"TP.")).replace(/Th\u1ecb x\xe3/g,"TX.")).replace(/X\xe3/g,"X.")).replace(/x\xe3/g,"X.")).replace(/Th\u1ecb tr\u1ea5n/g,"TT.")).replace(/Huy\u1ec7n/g,"H.")},m=function(){try{var e=localStorage.getItem(v);if(!e)return null;var t=JSON.parse(e),r=d.a.get(f);return u()(t,"data.delivery_zone")===r&&parseInt((new l.a).format("X"))-u()(t,"create_at",0)<=3600?t:(d.a.remove(f),localStorage.removeItem(v),null)}catch(n){return null}},h=function(){var e=Object(c.a)(a.a.mark((function e(t){var r,n,c,i,s,l,b,g,h,y;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=m()){e.next=24;break}if(n=void 0,c=void 0,!t){e.next=12;break}return e.next=8,Object(p.a)([{url:"/v2/me/delivery_zone",method:"get"},{url:"/v2/me/address?limit=10000",method:"get"}]);case 8:i=e.sent,s=Object(o.a)(i,2),n=s[0],c=s[1];case 12:if(!n||!n.data){e.next=18;break}return l=n.data,r={create_at:(new Date).getTime(),data:l},localStorage.setItem(v,JSON.stringify(r)),d.a.set(f,l.delivery_zone),e.abrupt("return",l);case 18:if(!c||!c.data){e.next=24;break}return h=(null===(b=c.data)||void 0===b||null===(g=b.data)||void 0===g?void 0:g.find((function(e){return!0===e.is_default})))||{},r={create_at:(new Date).getTime(),data:h},localStorage.setItem(v,JSON.stringify(r)),d.a.set(f,h.delivery_zone),e.abrupt("return",h);case 24:return y=u()(r,"data"),e.abrupt("return",y);case 28:return e.prev=28,e.t0=e.catch(0),console.log("LOCATION",e.t0),e.abrupt("return",null);case 32:case"end":return e.stop()}}),e,null,[[0,28]])})));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=Object(c.a)(a.a.mark((function e(){var t,r,n,o,c,i,s,l,g,h=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!(h.length>0&&void 0!==h[0])||h[0],r={},e.prev=2,e.next=5,Object(p.a)({url:"https://api.tiki.vn/delivery/api/v2/location-detection"});case 5:if(n=e.sent,(o=u()(n,"data.data"))&&o.delivery_zone){e.next=10;break}return console.error("Cannot detect user location."),e.abrupt("return");case 10:if(r={create_at:(new Date).getTime(),data:o},m()||(localStorage.setItem(v,JSON.stringify(r)),d.a.set(f,o.delivery_zone)),!t||!navigator.geolocation){e.next=30;break}return e.next=16,b({enableHighAccuracy:!1});case 16:if(c=e.sent,i=u()(c,"coords.latitude"),s=u()(c,"coords.longitude"),!i||!s){e.next=30;break}return e.next=22,Object(p.a)({url:"/shopping/v1/location-detection",params:{latitude:i,longitude:s}});case 22:if(l=e.sent,(g=u()(l,"data.data"))&&g.delivery_zone){e.next=27;break}return console.error("Cannot detect user location."),e.abrupt("return");case 27:r={create_at:(new Date).getTime(),data:g},localStorage.setItem(v,JSON.stringify(r)),d.a.set(f,g.delivery_zone);case 30:e.next=35;break;case 32:e.prev=32,e.t0=e.catch(2),console.error("User automatic location error occurred",e.t0);case 35:return e.abrupt("return",r.data);case 36:case"end":return e.stop()}}),e,null,[[2,32]])})));return function(){return e.apply(this,arguments)}}(),k=function(){var e=Object(c.a)(a.a.mark((function e(){var t,r,n,o,c,i,s,l,d;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!navigator.geolocation){e.next=24;break}return e.prev=1,e.next=4,b({enableHighAccuracy:!1});case 4:if(t=e.sent,r=u()(t,"coords.latitude"),n=u()(t,"coords.longitude"),!r||!n){e.next=17;break}return e.next=10,Object(p.a)({url:"https://api.tiki.vn/delivery/api/v2/location-detection",params:{latitude:r,longitude:n}});case 10:if(o=e.sent,(c=u()(o,"data.data"))&&c.delivery_zone){e.next=15;break}return console.error("Cannot detect user location."),e.abrupt("return");case 15:return i={create_at:(new Date).getTime(),data:c},e.abrupt("return",i.data);case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(1),console.error("User automatic location error occurred",e.t0);case 22:e.next=38;break;case 24:return e.prev=24,e.next=27,Object(p.a)({url:"https://api.tiki.vn/delivery/api/v2/location-detection"});case 27:if(s=e.sent,(l=u()(s,"data.data"))&&l.delivery_zone){e.next=32;break}return console.error("Cannot detect user location."),e.abrupt("return");case 32:return d={create_at:(new Date).getTime(),data:l},e.abrupt("return",d.data);case 36:e.prev=36,e.t1=e.catch(24);case 38:case"end":return e.stop()}}),e,null,[[1,19],[24,36]])})));return function(){return e.apply(this,arguments)}}()}}]);